#!/bin/bash

# Post-rewrite hook: Sync BricksSync changes from production after rebase
# This ensures devs have latest client changes when rebasing with staging

if [[ "$1" == "rebase" ]]; then
    # Only sync when rebasing with staging branch
    current_branch=$(git branch --show-current)
    if [[ "$current_branch" == "staging" ]]; then
        echo ""
        echo "Rebase with staging completed - syncing with production BricksSync changes..."
        
        # Check if sync script exists
        if [[ -f "scripts/sync-production-brickssync.sh" ]]; then
            echo "Syncing latest production changes..."
            ./scripts/sync-production-brickssync.sh
            
            # Check for conflicts
            if git diff --name-only --diff-filter=U | grep -q "brickssync-json"; then
                echo "WARNING: Conflicts detected in BricksSync files"
                echo "Review and resolve conflicts before continuing"
            else
                echo "SUCCESS: Production changes synced successfully!"
            fi
        else
            echo "WARNING: Sync script not found: scripts/sync-production-brickssync.sh"
        fi
    fi
fi
